"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.waitForDebounceFactory = void 0;
var Deferred_1 = require("evt/tools/Deferred");
var StatefulObservable_1 = require("../tools/StatefulObservable");
function waitForDebounceFactory(params) {
    var delay = params.delay;
    var obsCurr = (0, StatefulObservable_1.createStatefulObservable)(function () { return undefined; });
    function waitForDebounce() {
        var dOut = new Deferred_1.Deferred();
        var timerCallback = function () {
            obsCurr.current = undefined;
            dOut.resolve();
        };
        if (obsCurr.current !== undefined) {
            clearTimeout(obsCurr.current.timer);
            obsCurr.current.timer = setTimeout(timerCallback, delay - (Date.now() - obsCurr.current.startTime));
            return dOut.pr;
        }
        else {
            var startTime = Date.now();
            obsCurr.current = {
                "timer": setTimeout(timerCallback, delay),
                startTime: startTime,
            };
        }
        return dOut.pr;
    }
    var obsIsDebouncing = (0, StatefulObservable_1.createStatefulObservable)(function () { return false; });
    obsCurr.subscribe(function (curr) { return obsIsDebouncing.current = curr !== undefined; });
    return {
        waitForDebounce: waitForDebounce,
        obsIsDebouncing: obsIsDebouncing
    };
}
exports.waitForDebounceFactory = waitForDebounceFactory;
//# sourceMappingURL=waitForDebounce.js.map