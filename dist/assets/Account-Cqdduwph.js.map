{"version":3,"file":"Account-Cqdduwph.js","sources":["../../src/keycloak-theme/account/pages/DynamicAttribute.tsx","../../src/keycloak-theme/account/pages/Account.tsx"],"sourcesContent":["import { AuthContext, AuthProvider, IAuthContext, TAuthConfig, TRefreshTokenExpiredEvent } from \"react-oauth2-code-pkce\"\nimport { useContext, useEffect, useState } from 'react'\n\n//----\n//list of all string and endpoint needed to perform the pkce call and retrieve the attribute info\n//----\n\nconst CLIENT_ID =       'account-console'\nconst AUTH_ENDPOINT =   'http://localhost:8080/realms/master/protocol/openid-connect/auth';\nconst TOKEN_ENDPOINT =  'http://localhost:8080/realms/master/protocol/openid-connect/token';\nconst REDIRECT_URI =    'http://localhost:8080/realms/master/account/';\nconst SCOPE =           'openid'\nconst INFO_ENDPOINT =   'http://localhost:8080/realms/master/account/?userProfileMetadata=true'\n\n//----\n\nconst authConfig: TAuthConfig = {\n    clientId: CLIENT_ID,\n    authorizationEndpoint: AUTH_ENDPOINT,\n    tokenEndpoint: TOKEN_ENDPOINT,\n    redirectUri: REDIRECT_URI,\n    scope: SCOPE,\n    onRefreshTokenExpire: (event: TRefreshTokenExpiredEvent) => window.confirm('Session expired. Refresh page to continue using the site?') && event.login(),\n  }\n\n//funzione asincrona che ottiene le informazioni relative agli attributi registrati, di default e custom\n//  token: rappresenta l'access_token che verra' poi utilizzato nell'authorization header della richiesta\nasync function getInfo(token: string) {\n\n    // effettuo la richesta tramite fetch prestando attenzione all'asincronicita'\n    const res = await fetch(INFO_ENDPOINT, {\n        method: \"GET\",\n        credentials: \"include\",\n        headers: {\n          \"Content-Type\": \"application/json\",\n          \"Authorization\": \"Bearer \" + token\n        }\n    })\n \n    //parso la risposta come json\n    let resJson = {};\n    try {\n        if (res.ok)\n            resJson = await res.json();\n    } catch (e) {\n        console.log(e)\n    }\n\n    //altrimenti torno un'oggetto vuoto \"{}\"\n    return resJson;\n}\n\n\nfunction UserInfo(): JSX.Element {\n    const {token} = useContext<IAuthContext>(AuthContext);\n    const [userData, setUserData] = useState<any[]>([]);\n    const [userDataValues, setUserDataValue] = useState<any[]>([]);\n\n    //permette di gestire in modo asincrono la creazione del form dinamico che e' basato sulla variabile USERDATA\n    useEffect(() => {\n        const fetchData = async () => {\n            try {\n                const response: any = await getInfo(token);\n                const userProfileMetadata = response.userProfileMetadata;\n                if (userProfileMetadata && userProfileMetadata.attributes) {\n                    setUserData(userProfileMetadata.attributes);\n                }\n                if (response && response.attributes){\n                    setUserDataValue(response.attributes)\n                }\n            } catch (error) {\n                console.error('Error fetching user info:', error);\n            }\n        };\n\n        fetchData();\n    }, [token]);\n\n    return <>\n        {/*ciclo l'array userData che contiene la lista di attributi da renderizzare */}\n        {userData.map((element: any, index: number) => {\n\n            // renderizzo solo gli attributi diversi da quelli di default\n            return element.name == 'username' || element.name == 'firstName' || element.name == 'lastName' || element.name == 'email'? <></> :\n                <div key={index} className=\"form-group\">\n\n                    {/* creo il label dell'attributo partendo dalle informazioni ricavate dall'array iniziale */}\n                    <label className=\"active control-label\" htmlFor={element.name}>\n                        {element.name}{element.required && <span className=\"required\"> *</span>}\n                    </label>\n\n                    {/* definisco le proprieta' dell'input relativo all'attributo sempre partendo dall'array inizale\n                    integrando anche userDataValues che contiente informazioni tipo valore iniziale e validators */}\n                    <input\n                        type=\"text\"\n                        className=\"form-control\"\n                        id={element.name}\n                        name={element.name}\n                        required={element.required}\n                        disabled={element.readOnly}\n                        defaultValue={userDataValues[element.name] ?? \"\"}\n                    />\n                </div>\n        })}\n    </>\n  }\n\n  //definisco l'oggetto finale che si espandera' poi in una lista di attributi dinamici, dipendenti dalle informazioni ottenute dal server di autenticazione\n  export default function BuildForm(): JSX.Element{\n    return <>\n        <AuthProvider authConfig={authConfig}>\n            <UserInfo ></UserInfo>\n        </AuthProvider>\n    </>\n  }","import { clsx } from \"keycloakify/tools/clsx\";\nimport type { PageProps } from \"keycloakify/account/pages/PageProps\";\nimport { useGetClassName } from \"keycloakify/account/lib/useGetClassName\";\nimport type { KcContext } from \"../kcContext\";\nimport type { I18n } from \"../i18n\";\nimport BuildForm from \"./DynamicAttribute\";\n\nexport default function Account(props: PageProps<Extract<KcContext, { pageId: \"account.ftl\" }>, I18n>) {\n    const { kcContext, i18n, doUseDefaultCss, Template, classes } = props;\n\n    const { getClassName } = useGetClassName({\n        doUseDefaultCss,\n        \"classes\": {\n            ...classes,\n            \"kcBodyClass\": clsx(classes?.kcBodyClass, \"user\")\n        }\n    });\n\n    const { url, realm, messagesPerField, stateChecker, account, referrer } = kcContext;\n\n    const { msg } = i18n;\n\n    return (\n        <Template {...{ kcContext, i18n, doUseDefaultCss, classes }} active=\"account\">\n            <div className=\"row d-flex align-items-center\">\n                <div className=\"col-md-8\">\n                    <h2>{msg(\"editAccountHtmlTitle\")}</h2>\n                </div>\n                <div className=\"col-md-4 subtitle\">\n                    <span className=\"subtitle\">\n                        <span className=\"required\">*</span> {msg(\"requiredFields\")}\n                    </span>\n                </div>\n            </div>\n            <form action={url.accountUrl} className=\"form-horizontal mt-3\" method=\"post\">\n                <nav>\n                <div className=\"nav nav-tabs\" id=\"nav-tab\" role=\"tablist\">\n                    <a className=\"nav-item nav-link active\" id=\"nav-tab1-tab\" data-bs-toggle=\"tab\" href=\"#nav-tab1\" role=\"tab\" aria-controls=\"nav-tab1\" aria-selected=\"true\">{msg(\"defaultAttributes\")}</a>\n                    <a className=\"nav-item nav-link\" id=\"nav-tab2-tab\" data-bs-toggle=\"tab\" href=\"#nav-tab2\" role=\"tab\" aria-controls=\"nav-tab2\" aria-selected=\"false\">{msg(\"additionalAttributes\")}</a>\n                  </div>\n                </nav>\n                <div className=\"tab-content pt-5\" id=\"nav-tabContent\">\n                  <div className=\"tab-pane p-0 fade show active\" id=\"nav-tab1\" role=\"tabpanel\" aria-labelledby=\"nav-tab1-tab\">\n\n                    <input type=\"hidden\" id=\"stateChecker\" name=\"stateChecker\" value={stateChecker} />\n\n                    {!realm.registrationEmailAsUsername && (\n                        <div className={clsx(\"form-group\", messagesPerField.printIfExists(\"username\", \"has-error\"))}>\n                            <div className=\"form-group\">\n                                <label className=\"active control-label\" htmlFor=\"username\">{msg(\"username\")}</label>\n                                {realm.editUsernameAllowed && <span className=\"required\">*</span>}\n                                <input\n                                        type=\"text\"\n                                        className=\"form-control\"\n                                        id=\"username\"\n                                        name=\"username\"\n                                        disabled={!realm.editUsernameAllowed}\n                                        defaultValue={account.username ?? \"\"}\n                                />\n                            </div>\n                        </div>\n                    )}\n                    <div className={clsx(\"form-group\", messagesPerField.printIfExists(\"email\", \"has-error\"))}>\n                        <label className=\"active control-label\" htmlFor=\"email\">{msg(\"email\")}</label>\n                        <input type=\"text\" className=\"form-control\" id=\"email\" name=\"email\" defaultValue={account.email ?? \"\"} />\n                    </div>\n                    <div className={clsx(\"form-group\", messagesPerField.printIfExists(\"lastName\", \"has-error\"))}>\n                        <label className=\"active control-label\" htmlFor=\"firstName\">{msg(\"firstName\")}</label>\n                        <input type=\"text\" className=\"form-control\" id=\"firstName\" name=\"firstName\" defaultValue={account.firstName ?? \"\"} />\n                    </div>\n                    <div className={clsx(\"form-group\", messagesPerField.printIfExists(\"lastName\", \"has-error\"))}>\n                        <label className=\"active control-label\" htmlFor=\"lastName\">{msg(\"lastName\")}</label>\n                        <input type=\"text\" className=\"form-control\" id=\"lastName\" name=\"lastName\" defaultValue={account.lastName ?? \"\"} />\n                    </div>\n\n                  </div>\n                  <div className=\"tab-pane p-0 fade\" id=\"nav-tab2\" role=\"tabpanel\" aria-labelledby=\"nav-tab2-tab\">\n                    <BuildForm></BuildForm>\n                  </div>\n                </div>\n\n                <div className=\"form-group d-flex justify-content-end\">\n                    <div id=\"kc-form-buttons\" className=\"col-md-offset-2 col-md-10 submit\">\n                        <div className=\"d-flex justify-content-end align-items-center\">\n                            {referrer !== undefined && <a className=\"m-3\" href={referrer?.url}>{msg(\"backToApplication\")}</a>}\n                            <button\n                                type=\"submit\"\n                                className={clsx(\n                                    getClassName(\"kcButtonClass\"),\n                                    getClassName(\"kcButtonDefaultClass\"),\n                                    getClassName(\"kcButtonLargeClass\"),\n                                    \"m-3\"\n                                )}\n                                name=\"submitAction\"\n                                value=\"Cancel\"\n                            >\n                                {msg(\"doCancel\")}\n                            </button>\n                            <button\n                                type=\"submit\"\n                                className={clsx(\n                                    getClassName(\"kcButtonClass\"),\n                                    getClassName(\"kcButtonPrimaryClass\"),\n                                    getClassName(\"kcButtonLargeClass\"),\n                                    \"m-3\"\n                                )}\n                                name=\"submitAction\"\n                                value=\"Save\"\n                            >\n                                {msg(\"doSave\")}\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </form>\n        </Template>\n    );\n}\n"],"names":["CLIENT_ID","AUTH_ENDPOINT","TOKEN_ENDPOINT","REDIRECT_URI","SCOPE","INFO_ENDPOINT","authConfig","event","getInfo","token","res","resJson","e","UserInfo","useContext","AuthContext","userData","setUserData","useState","userDataValues","setUserDataValue","useEffect","response","userProfileMetadata","error","jsx","Fragment","element","index","jsxs","BuildForm","AuthProvider","Account","props","kcContext","i18n","doUseDefaultCss","Template","classes","getClassName","useGetClassName","clsx","url","realm","messagesPerField","stateChecker","account","referrer","msg"],"mappings":"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AER"}